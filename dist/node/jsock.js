!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Jsock",[],t):"object"==typeof exports?exports.Jsock=t():e.Jsock=t()}(global,(function(){return(()=>{"use strict";var e={554:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(993),t),o(r(864),t),o(r(413),t)},993:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useProperty=void 0;const n=r(304);t.useProperty=function(e){const t=n.UnitScopeManager.getStorage().next();return t.init(e),[t.value,t.set]}},864:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useReference=void 0;const n=r(554);t.useReference=function(e){const[t]=n.useProperty({current:e});return t}},413:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSideEffect=void 0;const n=r(554),o=r(86),i=r(304);t.useSideEffect=function(e,t){const r=n.useReference([]);t&&o.compareArrays(t,r.current)||(i.UnitScopeManager.deferAction(e),t&&(r.current=t))}},10:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.actionQueue=void 0,t.actionQueue=function(){const e=[];let t=!1;return{exec:function r(n){t?e.push(n):(t=!0,n(),(()=>{for(t=!1;;){const t=e.shift();if(!t)break;r(t)}})())},get isRunning(){return t}}}},908:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compareArrays=void 0,t.compareArrays=function(e,t){if(e.length!==t.length)return!1;for(const r in e)if(!Object.is(e[r],t[r]))return!1;return!0}},545:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.iterateOver=void 0,t.iterateOver=function(e){const t=e[Symbol.iterator]();return{next:()=>t.next().value}}},86:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(10),t),o(r(908),t),o(r(545),t),o(r(33),t)},33:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.limitedAction=void 0,t.limitedAction=function(e,t=1){const r=()=>Array.from({length:t},(()=>e));let n=r();return{call:(...e)=>(n.pop()??(()=>{}))(...e),reset:()=>{n=r()}}}},304:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Unit=void 0;var i=r(983);Object.defineProperty(t,"Unit",{enumerable:!0,get:function(){return i.Unit}}),o(r(137),t),o(r(696),t)},983:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Unit=void 0;const n=r(86),o=r(137),i=r(696);t.Unit=function(e){return(...t)=>{const r={},c=n.actionQueue(),u=n.limitedAction((()=>{i.UnitScopeManager.deferAction(f)}),1),a=o.unitPropertyStorage((()=>u.call())),s={storage:a},f=()=>c.exec((()=>i.UnitScopeManager.with(s).run((()=>{u.reset(),a.reset(),Object.assign(r,e(...t))}))));return f(),r}}},137:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(395),t),o(r(957),t),o(r(318),t)},395:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(401),t),o(r(804),t)},401:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initUnitProperty=void 0;const n=r(137);t.initUnitProperty=function(e){const t={value:void 0,init(e){this.value=n.resolveInitializer(e,void 0),this.init=()=>{}},set(t){this.value=n.resolveInitializer(t,this.value),e()}};return t.init=t.init.bind(t),t.set=t.set.bind(t),t}},804:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},318:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(213),t),o(r(856),t)},213:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInitializer=void 0,t.resolveInitializer=function(e,t){return"function"==typeof e?e(t):e}},856:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},957:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(813),t),o(r(161),t)},813:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unitPropertyStorage=void 0;const n=r(137),o=r(86);t.unitPropertyStorage=function(e){const t=[];let r=o.iterateOver(t);return{reset:()=>{r=o.iterateOver(t)},next:()=>{const o=r.next();if(o)return o;const i=n.initUnitProperty(e);return t.push(i),i}}}},161:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},696:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(854),t),o(r(989),t)},854:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnitScopeManager=void 0;const n={storage:r(137).unitPropertyStorage((()=>{}))};class o{static validateScopeExistence(){if(0===o.scopeStack.length)throw new Error("Usage of hooks outside of unit body is forbidden.")}static enterScope(e){o.scopeStack.push(e)}static leaveScope(){o.scopeStack.pop(),0===o.scopeStack.length&&o.executeSideEffects()}static getScope(){return o.validateScopeExistence(),o.scopeStack[o.scopeStack.length]}static executeSideEffects(){const e=[...o.sideEffects];o.sideEffects=[],o.with(n).run((()=>{for(const t of e)t()}))}static with(e){return{run(t){o.enterScope(e),t(),o.leaveScope()}}}static getStorage(){return o.getScope().storage}static deferAction(e){o.scopeStack.length>0?o.sideEffects.push(e):e()}}t.UnitScopeManager=o,o.sideEffects=[],o.scopeStack=[]},989:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}var n={};return(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.Unit=e.useReference=e.useSideEffect=e.useProperty=void 0;var t=r(554);Object.defineProperty(e,"useProperty",{enumerable:!0,get:function(){return t.useProperty}}),Object.defineProperty(e,"useSideEffect",{enumerable:!0,get:function(){return t.useSideEffect}}),Object.defineProperty(e,"useReference",{enumerable:!0,get:function(){return t.useReference}});var o=r(304);Object.defineProperty(e,"Unit",{enumerable:!0,get:function(){return o.Unit}})})(),n})()}));